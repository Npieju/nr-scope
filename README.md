# nr-scope

`nk-tracer` が出力した券種別CSVを入力に、
比較可能な券種同士で**合成オッズ**を並べて検討するアプリです。

## セットアップ

```bash
cd /home/nr-scope
pip install -r requirements.txt
```

## 起動

```bash
streamlit run app.py
```

ブラウザで開いたら、CSV ディレクトリに次のようなパスを指定して実行してください。

- `/home/nk-tracer/out/saudi_cup_csv`
- `/home/nk-tracer/out/batch/<race_id>/csv`

## 比較テーブル

- 比較1: `単勝` vs `馬単1着流し` vs `三連単1着流し`
- 比較2: `単勝` vs `馬連流し` vs `三連複流し`
- 比較3: `馬連` vs `馬単裏表`

不要なランキング表示（高オッズ順の総合順位など）は出しません。

## 合成オッズの考え方

- 組み合わせ集合のオッズ `o1, o2, ..., on` に対して、
	暗黙確率 `1/oi` を合計して `P = Σ(1/oi)` とする
- 合成オッズは `1/P`
- これにより「その馬をその券種で買う」場合の市場評価を1つの値に圧縮できます

## 詳細計算モード

- 消し馬を馬番で指定すると、その馬を含む組み合わせを計算から除外
- 例: `3,8` を指定すると、3番・8番を含む馬連/馬単/三連系を除外

## ファイル構成

- `app.py`: Streamlit UI
- `predictor.py`: CSV読込とスコア算出ロジック
- `requirements.txt`: 依存パッケージ

## 今後の拡張例

- 過去結果を使った期待値/回収率ベースの最適化
- 購入予算を考慮した券種配分（ポートフォリオ化）
- 複数レース同時比較とバックテスト
